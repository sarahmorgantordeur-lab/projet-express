---

# **Mini-cours : API Todo en Node.js avec Express (Architecture MVC + Services)**

---

## **1Ô∏è‚É£ Concepts de base**

### **Node.js**

* Plateforme qui permet d‚Äôex√©cuter du JavaScript c√¥t√© serveur.
* Id√©al pour cr√©er des API REST, serveurs web, ou manipuler des fichiers et bases de donn√©es.

### **Express**

* Framework minimaliste pour Node.js.
* Simplifie la cr√©ation de routes, la gestion des requ√™tes et r√©ponses HTTP, et l‚Äôorganisation du code.

### **API REST**

* API = Application Programming Interface
* REST = Repr√©sentation State Transfer (mani√®re standardis√©e d‚Äô√©changer des donn√©es via HTTP)
* M√©thodes principales :

  * **GET** ‚Üí r√©cup√©rer des donn√©es
  * **POST** ‚Üí cr√©er des donn√©es
  * **PUT / PATCH** ‚Üí modifier des donn√©es
  * **DELETE** ‚Üí supprimer des donn√©es

Dans ton projet :

* `GET /api/todos` ‚Üí r√©cup√©rer toutes les t√¢ches
* `POST /api/todos` ‚Üí cr√©er une nouvelle t√¢che

---

## **2Ô∏è‚É£ Architecture MVC + Service**

### **M : Mod√®le**

* Contient les **donn√©es brutes** et la logique de manipulation des donn√©es.
* Dans ton projet : `src/models/todo.model.js`

  * Tableau `todos` en m√©moire pour stocker les t√¢ches
  * M√©thodes :

    * `findAll()` ‚Üí retourne toutes les t√¢ches
    * `create(todo)` ‚Üí ajoute une t√¢che

### **V : Vue**

* Pour une API, la ‚Äúvue‚Äù n‚Äôest pas un fichier HTML, mais la **r√©ponse JSON envoy√©e au client**.
* Express g√®re √ßa via `res.json()`.

### **C : Contr√¥leur**

* Re√ßoit les requ√™tes HTTP, appelle le **service**, puis renvoie la r√©ponse.
* Exemple : `getAllTodos(req, res)` ou `createTodo(req, res)`
* Il ne touche jamais directement au mod√®le ou √† la base de donn√©es, il d√©l√®gue au service.

### **Service**

* Contient la **logique m√©tier**, c‚Äôest-√†-dire les r√®gles qui r√©gissent ton application.
* Exemple : **titre obligatoire pour cr√©er une t√¢che**
* S√©pare le ‚Äúquoi faire‚Äù (service) du ‚Äúcomment le recevoir/envoyer‚Äù (contr√¥leur)

---

## **3Ô∏è‚É£ Comment √ßa fonctionne dans ton projet**

1. **Le client** (navigateur, Postman, curl) envoie une requ√™te HTTP :

   * `GET /api/todos` ou `POST /api/todos`
2. **Express** re√ßoit la requ√™te et la dirige vers la **route correspondante** (`todo.routes.js`)
3. La **route** appelle le **contr√¥leur**
4. Le **contr√¥leur** appelle le **service**
5. Le **service** applique les **r√®gles m√©tier**
6. Le service utilise le **mod√®le** pour acc√©der aux donn√©es (ici le tableau `todos`)
7. Les donn√©es sont retourn√©es au **contr√¥leur**, qui les envoie au client en **JSON**

---

## **4Ô∏è‚É£ Avantages de cette approche**

1. **S√©paration des responsabilit√©s**

   * Mod√®le = donn√©es
   * Service = r√®gles m√©tier
   * Contr√¥leur = interface HTTP
   * Route = URL
     ‚Üí Plus facile √† maintenir et √† √©tendre

2. **R√©utilisabilit√©**

   * Le service peut √™tre utilis√© par plusieurs contr√¥leurs ou m√™me d‚Äôautres projets

3. **Testabilit√©**

   * On peut tester chaque partie s√©par√©ment (unit tests)
   * Exemple : tester `TodoService.createTodo()` sans lancer le serveur

4. **Lisibilit√© et organisation**

   * Les projets restent clairs m√™me quand ils deviennent grands

5. **√âvolutivit√©**

   * Facile de remplacer le mod√®le m√©moire par une vraie base de donn√©es (MongoDB, PostgreSQL‚Ä¶) sans changer le reste du code

---

## **5Ô∏è‚É£ Exemple concret : ce que tu as fait**

* Cr√©ation d‚Äôun **API Todo simple** avec Node.js et Express
* Architecture **MVC + service** :

  * `src/models/todo.model.js` ‚Üí donn√©es
  * `src/services/todo.service.js` ‚Üí r√®gles m√©tier
  * `src/controllers/todo.controller.js` ‚Üí traitement des requ√™tes
  * `src/routes/todo.routes.js` ‚Üí mapping URL ‚Üí contr√¥leur
* Test via **curl / Postman / navigateur**
* Gestion des erreurs (r√®gle m√©tier : titre obligatoire)
* R√©ponse en **JSON** pour l‚ÄôAPI REST

---

### üîπ Sch√©ma simplifi√©

```
[ Client / Postman / curl ]
             |
             v
        [ Routes ] ---------> (GET / POST)
             |
             v
       [ Controller ]
             |
             v
        [ Service ] --- r√®gles m√©tier
             |
             v
        [ Model ] --- acc√®s aux donn√©es
             |
             v
        [ JSON Response ] ‚Üí Client
```

---

üí° **R√©sum√© p√©dagogique**

* Tu as construit une **API REST compl√®te** en Node.js
* Tu as appris √† **s√©parer le code** proprement (MVC + service)
* Tu sais tester via **terminal ou Postman**
* Tu peux **√©tendre le projet facilement** pour ajouter une DB, de nouvelles routes, ou d‚Äôautres r√®gles m√©tier

---


**guide pratique pr√™t √† copier-coller** pour tester l'API Todo **directement depuis le terminal** avec `curl`.

---

# **Guide pratique de test de l‚ÄôAPI Todo**

## **1Ô∏è‚É£ V√©rifier que le serveur tourne**

```bash
npm run dev
```

ou

```bash
node ./src/server.js
```

* Le serveur doit √™tre actif sur : `http://localhost:3000`
* Si tout va bien, aucune erreur dans le terminal

---

## **2Ô∏è‚É£ Tester GET `/api/todos`**

R√©cup√©rer toutes les t√¢ches :

```bash
curl -X GET http://localhost:3000/api/todos
```

* R√©sultat attendu (vide au d√©but) :

```json
[]
```

---

## **3Ô∏è‚É£ Tester POST `/api/todos`**

### Cr√©er une nouvelle t√¢che

```bash
curl -X POST http://localhost:3000/api/todos \
-H "Content-Type: application/json" \
-d '{"title":"Apprendre Node"}'
```

* R√©sultat attendu :

```json
{
  "id": 1,
  "title": "Apprendre Node",
  "completed": false
}
```

### Cr√©er plusieurs t√¢ches

```bash
curl -X POST http://localhost:3000/api/todos \
-H "Content-Type: application/json" \
-d '{"title":"Faire les courses"}'

curl -X POST http://localhost:3000/api/todos \
-H "Content-Type: application/json" \
-d '{"title":"Lire un livre"}'
```

* Chaque t√¢che aura un **ID unique** incr√©ment√© automatiquement

---

### Tester r√®gle m√©tier : titre obligatoire

```bash
curl -X POST http://localhost:3000/api/todos \
-H "Content-Type: application/json" \
-d '{"title":""}'
```

* R√©sultat attendu : erreur 400 avec message

```json
{ "error": "Le titre est obligatoire" }
```

---

## **4Ô∏è‚É£ V√©rifier √† nouveau GET**

```bash
curl -X GET http://localhost:3000/api/todos
```

* R√©sultat attendu : toutes les t√¢ches cr√©√©es pr√©c√©demment

```json
[
  { "id": 1, "title": "Apprendre Node", "completed": false },
  { "id": 2, "title": "Faire les courses", "completed": false },
  { "id": 3, "title": "Lire un livre", "completed": false }
]
```

---

## **5Ô∏è‚É£ Astuces suppl√©mentaires**

### Tester dans un navigateur

* `GET /api/todos` ‚Üí tape directement :

```
http://localhost:3000/api/todos
```

### Cr√©er une route racine `/` pour tester facilement

Dans `app.js` :

```js
app.get('/', (req, res) => {
  res.send('Bienvenue sur l\'API Todo ! Utilisez /api/todos pour les t√¢ches.');
});
```

* Ensuite, `GET /` ‚Üí affiche un message au lieu de ‚ÄúCannot GET /‚Äù

---

‚úÖ Avec ces commandes, tu peux **tester toutes les fonctionnalit√©s de ton API Todo** sans Postman, juste dans le terminal.

---


**script Bash complet** pr√™t √† copier-coller dans Git Bash / WSL / Linux, qui teste l'API Todo de bout en bout :

* V√©rifie le serveur
* Cr√©e plusieurs t√¢ches
* Teste la r√®gle m√©tier (titre obligatoire)
* Affiche la liste finale des t√¢ches

---

### **script-test-todo.sh**

```bash
#!/bin/bash

echo "=== Test API Todo ==="

# 1Ô∏è‚É£ V√©rifier que le serveur tourne
echo
echo ">>> GET /api/todos (initial)"
curl -s -X GET http://localhost:3000/api/todos | jq
echo -e "\n"

# 2Ô∏è‚É£ Cr√©er une nouvelle t√¢che
echo ">>> POST /api/todos : 'Apprendre Node'"
curl -s -X POST http://localhost:3000/api/todos \
-H "Content-Type: application/json" \
-d '{"title":"Apprendre Node"}' | jq
echo -e "\n"

echo ">>> POST /api/todos : 'Faire les courses'"
curl -s -X POST http://localhost:3000/api/todos \
-H "Content-Type: application/json" \
-d '{"title":"Faire les courses"}' | jq
echo -e "\n"

echo ">>> POST /api/todos : 'Lire un livre'"
curl -s -X POST http://localhost:3000/api/todos \
-H "Content-Type: application/json" \
-d '{"title":"Lire un livre"}' | jq
echo -e "\n"

# 3Ô∏è‚É£ Tester la r√®gle m√©tier (titre vide)
echo ">>> POST /api/todos : titre vide (doit √©chouer)"
curl -s -X POST http://localhost:3000/api/todos \
-H "Content-Type: application/json" \
-d '{"title":""}' | jq
echo -e "\n"

# 4Ô∏è‚É£ V√©rifier √† nouveau GET
echo ">>> GET /api/todos (final)"
curl -s -X GET http://localhost:3000/api/todos | jq
echo -e "\n"

echo "=== Fin du test ==="
```

---

### **Instructions pour l‚Äôutiliser**

1. Cr√©e un fichier `script-test-todo.sh` √† la racine de ton projet
2. Copie-colle le contenu ci-dessus
3. Assure-toi que `jq` est install√© (pour formater le JSON) :

```bash
sudo apt install jq      # Linux
choco install jq         # Windows via Chocolatey
```

4. Donne les droits d‚Äôex√©cution :

```bash
chmod +x script-test-todo.sh
```

5. Lance le script **pendant que ton serveur tourne** :

```bash
./script-test-todo.sh
```

* Tu verras toutes les requ√™tes GET et POST s‚Äôex√©cuter automatiquement
* Les r√©ponses JSON seront joliment format√©es gr√¢ce √† `jq`

---


version **100% Git Bash / Windows**, sans d√©pendance externe (`jq`), pr√™te √† copier-coller et ex√©cuter :

---

### **script-test-todo-windows.sh**

```bash
#!/bin/bash

echo "=== Test API Todo ==="

# 1Ô∏è‚É£ GET initial
echo
echo ">>> GET /api/todos (initial)"
curl -s -X GET http://localhost:3000/api/todos
echo -e "\n"

# 2Ô∏è‚É£ POST : cr√©er des t√¢ches
echo ">>> POST /api/todos : 'Apprendre Node'"
curl -s -X POST http://localhost:3000/api/todos -H "Content-Type: application/json" -d '{"title":"Apprendre Node"}'
echo -e "\n"

echo ">>> POST /api/todos : 'Faire les courses'"
curl -s -X POST http://localhost:3000/api/todos -H "Content-Type: application/json" -d '{"title":"Faire les courses"}'
echo -e "\n"

echo ">>> POST /api/todos : 'Lire un livre'"
curl -s -X POST http://localhost:3000/api/todos -H "Content-Type: application/json" -d '{"title":"Lire un livre"}'
echo -e "\n"

# 3Ô∏è‚É£ Tester la r√®gle m√©tier (titre vide)
echo ">>> POST /api/todos : titre vide (doit √©chouer)"
curl -s -X POST http://localhost:3000/api/todos -H "Content-Type: application/json" -d '{"title":""}'
echo -e "\n"

# 4Ô∏è‚É£ GET final
echo ">>> GET /api/todos (final)"
curl -s -X GET http://localhost:3000/api/todos
echo -e "\n"

echo "=== Fin du test ==="
```

---

### **Comment l‚Äôutiliser**

1. Cr√©e un fichier `script-test-todo-windows.sh` √† la racine de ton projet
2. Copie-colle le contenu ci-dessus
3. Lance ton serveur :

```bash
npm run dev
```

4. Dans un autre terminal Git Bash, lance le script :

```bash
bash script-test-todo-windows.sh
```

* Toutes les requ√™tes GET et POST seront ex√©cut√©es
* Les r√©ponses JSON s‚Äôafficheront directement dans le terminal
* Tu verras la cr√©ation des t√¢ches et la v√©rification de la r√®gle m√©tier

---


